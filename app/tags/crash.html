<pop-crash>
    <pop-crash-before show={isReady}
                      width={width}
                      height={height}
                      on-crash-requested={crash}
                      shout-word={shoutWord}
                      building-initial={buildingInitial}></pop-crash-before>
    <pop-crash-after show={ !isReady }
                     width={width}
                     height={height}
                     shout-word={shoutWord}
                     building-initial={buildingInitial}/></pop-crash-after>

    <script>
        this.shoutWord = get()["boardName"] + "ゥァアーッ";
        this.buildingInitial = get()["boardName"].slice(0, 1);
        this.isReady = true;
        this.width = null;
        this.height = null;
        this.shakeEvent = null;

        this.on('mount', () => {
            console.log("pop crash mounted.");

            this.shakeEvent = new Shake({
                threshold: 10,
                timeout: 1000
            });
            this.shakeEvent.start();

            window.addEventListener("resize", this.updateSize);
            window.addEventListener('shake', this.crash);

            this.updateSize();
        });

        this.on('before-unmount', function () {
            window.removeEventListener("resize", this.updateSize);
            window.removeEventListener('shake', this.crash);
            this.shakeEvent.stop();
            this.shakeEvent = null;
        });

        this.crash = () => {
            if (!this.isReady) {
                return;
            }

            this.update({isReady: false});
            setTimeout(() => this.update({isReady: true}), 1000);

            this.vibrate();
        };

        this.updateSize = () => this.update({
            width: window.innerWidth,
            height: window.innerWidth * (284 / 420),
        });

        this.vibrate = () => {
            navigator.vibrate([100, 20, 300])
        };

    </script>

    <style>
        :scope {
            display: block;
            background-color: rgba(0, 0, 0, 0.05);
            width: 100%;
            height: 100%;
        }
    </style>
</pop-crash>
