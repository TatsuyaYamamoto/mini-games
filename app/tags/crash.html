<pop-crash>
    <pop-crash-before if={ isReady }
                      on-click-image={crash}
                      building-initial={buildingInitial}></pop-crash-before>
    <pop-crash-after if={ !isReady }
                     shout-word={shoutWord}
                     building-initial={buildingInitial}></pop-crash-after>

    <script>
        this.shoutWord = get()["boardName"] + "ゥァアーッ";
        this.buildingInitial = get()["boardName"].slice(0, 1);
        this.isReady = true;

        this.on('mount', () => {
            console.log("pop crash mounted.");
        });

        this.crash = () => {
            this.update({isReady: false});

            setTimeout(() => this.update({isReady: true}), 1000);
        };

    </script>

    <style>
        :scope {
            display: block;
            background-color: rgba(0, 0, 0, 0.05);
            width: 100%;
            height: 100%;
        }
    </style>
</pop-crash>


<pop-crash-before>
    <img id="crash-image" src="images/crash_before.png" onclick="{ opts.onClickImage }"/>
    <div id="building-initial"> {opts.buildingInitial}</div>
    <back-svg id="back-icon" onclick={goNameView}></back-svg>
    <question-svg id="question-icon" onclick={showHelp}></question-svg>

    <script>
        this.crashImage = null;
        this.buildingInitial = null;
        this.questionIcon = null;
        this.backIcon = null;

        this.on('mount', () => {
            console.log("crash before mounted");

            this.crashImage = document.getElementById("crash-image");
            this.buildingInitial = document.getElementById("building-initial");
            this.questionIcon = document.getElementById("question-icon");
            this.backIcon = document.getElementById("back-icon");

            this.crashImage.onload = () => this.calcComponentPosition();
            window.addEventListener("resize", this.calcComponentPosition);
        });

        this.on('before-unmount', function () {
            window.removeEventListener("resize", this.calcComponentPosition);
        });

        this.goNameView = function () {
            route("/");
        };

        this.showHelp = function () {
            this.showHelp = function () {
                swal("画像をタップか、端末を振る");
            };
        };

        this.calcComponentPosition = (e) => {
            const {clientWidth, clientHeight} = this.crashImage;

            this.buildingInitial.style.top = clientHeight * 0.45;
            this.buildingInitial.style.left = clientWidth * 0.26;
            this.buildingInitial.style.fontSize = clientWidth * 0.05;

            this.backIcon.style.top = clientHeight * 0.05;
            this.backIcon.style.left = clientWidth * 0.05;
            this.backIcon.style.height = clientWidth * 0.08;
            this.backIcon.style.width = clientWidth * 0.08;

            this.questionIcon.style.top = clientHeight * 0.05;
            this.questionIcon.style.right = clientWidth * 0.05;
            this.questionIcon.style.height = clientWidth * 0.08;
            this.questionIcon.style.width = clientWidth * 0.08;
        }
    </script>

    <style>
        #crash-image {
            width: 100%;
            height: auto;
        }

        #building-initial {
            position: absolute;
            transform: rotate(15deg);
        }

        #question-icon {
            position: absolute;
        }

        #back-icon {
            position: absolute;
        }
    </style>
</pop-crash-before>


<pop-crash-after>
    <img id="crash-image-after" src="images/crash_after.png"/>
    <div id="shout-word"> {opts.shoutWord}</div>
    <div id="crashed-building-initial"> {opts.buildingInitial}</div>

    <script>
        this.crashImage = null;
        this.shoutWord = null;
        this.buildingInitial = null;

        this.on('mount', function () {
            console.log("crash after mounted.");

            this.crashImage = document.getElementById("crash-image-after");
            this.shoutWord = document.getElementById("shout-word");
            this.buildingInitial = document.getElementById("crashed-building-initial");

            this.crashImage.onload = () => this.calcComponentPosition();
            window.addEventListener("resize", this.calcComponentPosition);
        });

        this.on('before-unmount', function () {
            window.removeEventListener("resize", this.calcComponentPosition);
        });

        this.calcComponentPosition = function () {
            const {clientWidth, clientHeight} = this.crashImage;

            this.shoutWord.style.top = clientHeight * 0.1;
            this.shoutWord.style.left = clientWidth * 0.87;
            this.shoutWord.style.fontSize = clientWidth * 0.04;

            this.buildingInitial.style.top = clientHeight * 0.355;
            this.buildingInitial.style.left = clientWidth * 0.225;
            this.buildingInitial.style.fontSize = clientWidth * 0.05;
        }
    </script>
    <style>
        #crash-image-after {
            width: 100%;
            height: auto;
        }

        #shout-word {
            position: absolute;
            writing-mode: vertical-rl;
        }

        #crashed-building-initial {
            position: absolute;
            transform: rotate(-3deg);
        }
    </style>
</pop-crash-after>
